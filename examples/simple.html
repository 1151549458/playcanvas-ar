<!doctype html>
<html>
    <head>
        <script src="http://code.playcanvas.com/playcanvas-latest.js"></script>
        <script src="../artoolkit/artoolkit.min.js"></script>
    </head>
    <body style="overflow: hidden;">
        <canvas id="playcanvas"></canvas>
        <script>
            var canvas = document.getElementById("playcanvas");
            canvas.style.position = 'absolute';
            canvas.style.top = '0px';
            canvas.style.left = '0px';

            // Create the application and start the update loop
            var app = new pc.Application(canvas);
            app.setCanvasFillMode(pc.FILLMODE_FILL_WINDOW);
            app.setCanvasResolution(pc.RESOLUTION_AUTO);
            app.start();

            // Load PlayCanvasAR library scripts
            app.assets.loadFromUrl("../playcanvas-ar.js", "script", function (err, asset) {

                // Create the AR-enabled camera and a light
                app.assets.loadFromUrl("../artoolkit/calibration/camera_para.dat", "binary", function (err, asset) {

                    // Create an Entity with a camera component
                    var camera = new pc.Entity("AR Camera");
                    camera.addComponent("camera", {
                        clearColor: new pc.Color(0, 0, 0, 0)
                    });
                    camera.addComponent("script");
                    camera.script.create("arCamera", {
                        attributes: {
                            cameraCalibration: asset,
                            thresholdMode: 0, // Manual
                            threshold: 100,
                            videoTexture: true
                        }
                    });
                    app.root.addChild(camera);
                });

                // Create a marker using the Hiro pattern and attach a cube to it
                app.assets.loadFromUrl("../artoolkit/patterns/patt.hiro", "binary", function (err, asset) {

                    // Creat the marker entity
                    var hiro = new pc.Entity("Hiro Marker");
                    hiro.addComponent("script");
                    hiro.script.create("arMarker", {
                        attributes: {
                            pattern: asset,
                            width: 1,
                            deactivationTime: 0.25,
                            shadow: true,
                            shadowStrength: 0.75
                        }
                    });
                    app.root.addChild(hiro);

                    // Create a box as a child of the Hiro marker
                    var box = new pc.Entity("Box");
                    box.addComponent("model", {
                        type: "box"
                    });
                    box.setLocalPosition(0, 0.5, 0);
                    hiro.addChild(box);

                    // Create a directional light
                    var light = new pc.Entity();
                    light.addComponent("light", {
                        type: "directional",
                        color: new pc.Color(1, 1, 1),
                        intensity: 1,
                        castShadows: true,
                        shadowResolution: 2048,
                        shadowDistance: 20
                    });
                    light.setLocalEulerAngles(22, 0, -16);
                    hiro.addChild(light);
                });
            });

            // Resize the canvas when the window is resized
            window.addEventListener('resize', function () {
                app.resizeCanvas(window.innerWidth, window.innerHeight);
            });
        </script>
    </body>
</html>